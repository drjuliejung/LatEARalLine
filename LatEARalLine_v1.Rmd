---
title: "LatEARalLine_v1"
author: "Julie Jung"
date: "July 5, 2019"
output: html_document
---

NOTE TO SELF: THIS IS THE LATEST/BEST VERSION OF VOR ANALYSIS. 

```{r setup, include=FALSE}
rm(list=ls()) #clear environment
setwd('/Users/juliejung/Documents/GitHub/VOR-ms') 
```

## install and load packages

```{r}
library(xlsx);library(clinfun);library(car)
library(MASS);library(multcomp);library(pscl);library(psych);library(lme4)
library("stargazer");library("knitr");library("dplyr")
library(sciplot);library(ggplot2);library(ggrepel); library(extrafont); library(ggthemes);library(reshape);library(grid);
library(scales);library(RColorBrewer);library(gridExtra);library(cowplot)
```

Colors
```{r}
#library(RColorBrewer)
#stagecolors <- brewer.pal("Dark2", n=6)
#clutchcolors<- c("red", "blue", "green", "purple", "orange")
#clutchgrays<- brewer.pal("Greys", n=9)
```

## Daily developmental series

```{r} 
jiggling.df<-read.xlsx("20190704_LatEARalLine.xlsx", sheetName="individual data")
#str(Daily.df) #note this includes the two 7d indivs
```
Subset out test vs pilot
```{r}
pilot <- subset(jiggling.df, jiggling.df$Data=="pilot")
test <- subset(jiggling.df, jiggling.df$Data=="test")
```

## GLMM

We used generalized linear mixed models (GLMM, lme4 package; Bates and Maechler 2009)

Use a GLMM with binomial error distribution to test if the probability of hatching was predicted by developmental stage and VOR. The response variable was the response of each individual embryo (hatched or not) and we included clutch as a random intercept in the model to account for non-independence of clutches. For GLMMs we estimated p values of our predictors by using likelihood ratio tests of nested models (Zuur et al. 2009).


incorporate clutch as a random effect

Run the models w/ both predictors, i.e. stage & VOR together in the model
Does stage contribute anything once individual VOR is in the model?

```{r}
glmm0 <- glmer(Response ~ 1 + (1|Clutch) + (1|Round), family=binomial(logit), data=test)
#glmm1 <- glmer(Response ~ Stage + (1|Clutch), family=binomial(logit), data=test)
glmm2 <- glmer(Response ~ Treatment + (1|Clutch) + (1|Round), family=binomial(logit), data=test)
#glmm3 <- glmer(Response ~ Stage + Treatment + (1|Clutch), family=binomial(logit), data=test)
#glmm4 <- glmer(Response ~ Stage * Treatment + (1|Clutch), family=binomial(logit), data=test)

summary(glmm0)
#summary(glmm1)
summary(glmm2)
#summary(glmm3)
#summary(glmm4)

AIC(glmm0)
#AIC(glmm1)
AIC(glmm2)
#AIC(glmm3)
#AIC(glmm4)

#anova(glmm1,glmm3) # treatment effect
#anova(glmm2,glmm3) # stage effect
#anova(glmm3,glmm4) # interaction effect

anova(glmm0,glmm2) #treatment effect
```

Hat and Not Hat
```{r}
hat <- subset(test, test$Response==1)
nohat <- subset(test, test$Response==0)
```

```{r}
plot.responseGLM<-ggplot(test, aes(x=Treatment, y=as.numeric(as.character((Response)), shape=as.factor(Response)))) +
  stat_smooth(method = "glm", method.args=list(family="binomial"), color="black", linetype="dashed") +
  geom_point(data=hat, shape=21, size=3, position=position_jitter(height=0.06, width=0.2)) +
  geom_point(data=nohat, shape=16, size=3, position=position_jitter(height=0.06, width=0.2)) +
  scale_y_continuous(breaks = c(0, 1))+
  theme(axis.text.y=element_text(size=14, colour= "black")) +
  theme(axis.text.x=element_text(size=14, colour= "black")) +
  theme(axis.title.x=element_text(size=14, colour = "black")) +
  theme(axis.title.y=element_text(size=14, colour = "black"))+
  labs(y = "Hatching response \n", 
       x = "\n Treatment")+
  theme_cowplot(font_size = 14, line_size = 1)

plot.responseGLM
```
